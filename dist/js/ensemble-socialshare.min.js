/*!
 * loltgt ensemble.SocialShare
 *
 * @version 0.0.1
 * @copyright Copyright (C) Leonardo Laureti
 * @license MIT License
 */
"use strict";!function(e,t,s,n){const i=n?n.base:s("../ensemble-stack-d1/base");class o extends i{_defaults(){return{ns:"share",fx:!0,root:"body",intents:{facebook:0,twitter:0,whatsapp:1,messenger:1,telegram:1,linkedin:0,"send-email":2,"copy-link":3,"web-share":4},uriform:{facebook:"https://facebook.com/sharer.php?u=%url%",twitter:"https://twitter.com/share?url=%url%&text=%title%",whatsapp:"https://api.whatsapp.com/send?text=%text%",messenger:"fb-messenger://share/?link=%url%&app_id=%app_id%",telegram:"https://telegram.me/share/url?url=%url%&text=%text%",linkedin:"https://www.linkedin.com/sharing/share-offsite?mini=true&url=%url%&title=%title%&ro=false&summary=%summary%","send-email":"mailto:?subject=%subject%&body=%text%"},label:{},locale:{label:"Share",share:"Share on %s",send:"Send to %s",subject:"An interesting thing",text:"Hi! There is something may interesting you: %s",email:"Send via email",copy:"Copy link",copied:"Copied link!",whatsapp:"WhatsApp",linkedin:"LinkedIn","web-share":"Share"},onInit:function(){},onIntent:function(){}}}_bindings(){this.intent=this.binds(this.intent)}constructor(e,t={}){super(),this._bindings(),this.options=this.defaults(this._defaults(),t),Object.freeze(this.options),this.element=e,this.init()}generator(){const e=this.options,t=this.share=this.compo("div","social-share");if(t.setAttr("data-social-share",""),t.up(this.element),e.label){const s=this.compo("span","label",e.label);s.classList.add("label"),t.append(s)}const s=this.actions=this.compo("ul","actions");t.append(s),this.built=!0}init(){const e=this.options;this.built||(this.root=this.selector(e.root),this.generator(),this.populate(),e.onInit.call(this,this))}populate(){const t=this.options;for(const s in t.intents){const n=s in t.locale?t.locale[s]:s.replace(/\w/,(e=>e.toUpperCase()));let i;switch(t.intents[s]){case 0:i=t.locale.share.replace("%s",n);break;case 1:i=t.locale.send.replace("%s",n);break;case 2:i=t.locale.email;break;case 3:i=t.locale.copy;break;case 4:if(!("share"in e.navigator)||"function"!=typeof e.navigator.share)continue;i=t.locale["web-share"]}this.action(s,i)}}action(e,t){const s=this.options,n=this.compo("li","action",{className:s.ns+"-action-"+e}),i=this.compo("button","intent",{className:s.ns+"-intent-"+e,title:t,ariaLabel:t,onclick:this.intent});n.setAttr("data-share-intent",e),n.append(i);const o=this.compo("span","icon",{className:"icon-"+e});i.append(o),this.actions.append(n)}intent(t,s){if(this.event(t),!t.isTrusted)return;const n=this.options,i=s._share.parentElement;if(!this.hasAttr(i,"data-share-intent"))return;const o=this.getAttr(i,"data-share-intent");let a,l,r,c;a=this.selector('link[rel="canonical"]')?this.selector('link[rel="canonical"]').href:e.location.href,l=r=document.title,this.selector('meta[name="description"]')&&(r=this.selector('meta[name="description"]').content),c="\r\n\r\n%title%\r\n%url%\r\n\r\n";const h={url:a,title:l,text:"\r\n\r\n%title%\r\n%url%\r\n\r\n",summary:r};if(n.onIntent.call(this,this,t,o,h),h.text=n.locale.text.replace("%s",h.text),o in n.intents)switch(o){case"send-email":this.sendEmail(t,h);break;case"copy-link":this.copyLink(t,h);break;case"web-share":this.webShare(t,h);break;default:this.social(t,h,o,i)}}text(e){return encodeURIComponent(e.text.replace("%url%",e.url).replace("%title%",e.title).replace("%summary%",e.summary))}social(t,s,n,i){const o=this.options;if(n in o.uriform==!1)return;let a=o.uriform[n].replace("%url%",encodeURIComponent(s.url)).replace("%title%",encodeURIComponent(s.title)).replace("%summary%",encodeURIComponent(s.summary));const l=this.getAttr(i,"ariaLabel"),r="toolbar=0,status=0,width=640,height=480";if(/%text%/.test(o.uriform[n])&&(a=a.replace("%text%",this.text(s))),"messenger"===n){const e="messenger_app_id"in o?o.messenger_app_id:"";a=a.replace("%app_id%",encodeURIComponent(e))}console.log(a,l,r),e.open(a,l,r)}sendEmail(t,s){const n=this.options,i=n.uriform["send-email"].replace("%subject%",encodeURIComponent(n.locale.subject)).replace("%text%",this.text(s));console.log(i,"_self"),e.open(i,"_self")}copyLink(t,s){const n=this.options,i=document.createElement("textarea");if(i.style="position:absolute;width:0;height:0;opacity:0;z-index:-1;overflow:hidden",i.value=s.url.toString(),this.appendNode(this.element,i),/iPad|iPhone|iPod/.test(e.navigator.userAgent)){const e=document.createRange(),t=getSelection();e.selectNodeContents(i),t.removeAllRanges(),t.addRange(e),i.setSelectionRange(0,999999)}else i.focus(),i.select();if(document.execCommand("copy"),i.remove(),n.fx){const e=this.root,t=this.compo("div","fx-copied-link--ground",{hidden:!0}),s=this.compo("span","copied-link-message",{innerText:n.locale.copied});e.classList.add("share-fx-copied-link"),t.install(e),s.install(e),t.show(),this.delay((function(){s.uninstall(e),t.uninstall(e),e.classList.remove("share-fx-copied-link")}),t,800)}}async webShare(t,s){try{await e.navigator.share({title:s.title,url:s.url})}catch(e){e instanceof TypeError?console.info("ensemble.SocialShare.webShare","TODO fallback"):console.log("ensemble.SocialShare.webShare",e.message)}}}e.ensemble={...n,SocialShare:o},t.exports=o}("undefined"!=typeof window?window:{},"undefined"!=typeof module?module:{},"undefined"!=typeof require?require:function(){},globalThis.ensemble);
//# sourceMappingURL=ensemble-socialshare.min.js.map
