!function(t,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var s={exports:{}};e(s.exports),t.ensemble=s.exports}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,(function(t){"use strict";
/*!
   * loltgt ensemble.Compo
   *
   * @version 0.0.1
   * @copyright Copyright (C) Leonardo Laureti
   * @license MIT License
   */Object.defineProperty(t,"__esModule",{value:!0}),t.SocialShare=void 0;const e="undefined"==typeof Symbol?0:Symbol,s=/html|head|body|meta|link|style|script/i,n=/(<(html|head|body|meta|link|style|script)*>)/i,i=/attributes|classList|innerHTML|outerHTML|nodeName|nodeType/;class o{constructor(t,e,n,r){if(!new.target)throw"ensemble error: Bad invocation, must be called with new.";const a=this._ns="_"+t,l=n?e.toString():"div";if(s.test(l))throw new Error(`ensemble.Compo error: The tag name provided ('${l}') is not a valid name.`);const h=this[a]=document.createElement(l);if(this.__Compo=!0,this[a].__compo=this,r&&"object"==typeof r)for(const e in r){const s=e.toString();if(i.test(s))throw new Error(`ensemble.Compo error: The property name provided ('${s}')' is not a valid name.`);if(0===s.indexOf("on")&&r[s])h[s]=r[s].bind(this);else if("object"!=typeof r[s])h[s]=r[s];else if("children"===s&&"object"==typeof r[s]&&r[s].length)for(const e of r.children){const s=e.tag,n=e.name,i=e.props;this.append(new o(t,s,n,i))}}if(0!=n&&1!=n){const s=h.className;h.className=t+"-"+e,n&&(h.className+=" "+t+"-"+n),s&&(h.className+=" "+s)}}install(t,e){return"function"==typeof e&&e.call(this,this[this._ns]),!!t.appendChild(this[this._ns])}uninstall(t,e){return"function"==typeof e&&e.call(this,this[this._ns]),!!t.removeChild(this[this._ns])}up(t,e){return"function"==typeof e&&e.call(this,this[this._ns]),!!t.replaceWith(this[this._ns])}append(t){const e=this._ns;return!!this[e].appendChild(t[e])}prepend(t){const e=this._ns;return!!this[e].prependChild(t[e])}remove(t){const e=this._ns;return!!this[e].removeChild(t[e])}replace(t){}clone(t=!1){}inject(t){if(t instanceof Element==0||s.test(t.tagName)||n.test(t.innerHTML))throw new Error("ensemble.Compo error: The remote object could not be resolved into a valid node.");return this.empty(),!!this[this._ns].appendChild(t)}empty(){for(;this.first;)this.remove(this.first)}hasAttr(t){return this[this._ns].hasAttribute(t)}getAttr(t){return this[this._ns].getAttribute(t)}setAttr(t,e){this[this._ns].setAttribute(t,e)}delAttr(t){this[this._ns].removeAttribute(t)}getStyle(t){return window.getComputedStyle(this[this._ns])[t]}show(){this[this._ns].hidden=!1}hide(){this[this._ns].hidden=!0}enable(){this[this._ns].disabled=!1}disable(){this[this._ns].disabled=!0}get node(){return console.warn("ensemble.Compo","Direct access to the Element node is strongly discouraged."),this[this._ns]}get parent(){const t=this._ns;return this[t].parentElement&&"__compo"in this[t].parentElement?this[t].parentElement.__compo:null}get children(){return Array.prototype.map.call(this[this._ns].children,(t=>t.__compo))}get first(){const t=this._ns;return this[t].firstElementChild?this[t].firstElementChild.__compo:null}get last(){const t=this._ns;return this[t].lastElementChild?this[t].lastElementChild.__compo:null}get previous(){const t=this._ns;return this[t].previousElementSibling?this[t].previousElementSibling.__compo:null}get next(){const t=this._ns;return this[t].nextElementSibling?this[t].nextElementSibling.__compo:null}get classList(){return this[this._ns].classList}static isCompo(t){return e?e.for(t)===e.for(o.prototype):t&&"object"==typeof t&&"__Compo"in t}get[e.toStringTag](){return"ensemble.Compo"}}
/*!
   * loltgt ensemble.Data
   *
   * @version 0.0.1
   * @copyright Copyright (C) Leonardo Laureti
   * @license MIT License
   */const r="undefined"==typeof Symbol?0:Symbol;class a{constructor(t,e){if(!new.target)throw"ensemble error: Bad invocation, must be called with new.";e&&"object"==typeof e&&Object.assign(this,{},e);const s=this._ns="_"+t;this.__Data=!0,this[s]={ns:t}}compo(t,e,s,n=!1,i=!1,r=!1){const a=this[this._ns].ns;let l;return l=n?{ns:a,tag:t,name:e,props:s,fresh:i,stale:r}:new o(a,t,e,s),i&&"function"==typeof i&&(l.fresh=s.onfresh=i),r&&"function"==typeof r&&(l.stale=s.onstale=r),l}async render(t){const e=this._ns;this[e][t]&&this[e][t].rendered||(this[e][t]={rendered:!0,fresh:this[t].fresh,stale:this[t].stale,params:this[t]},this[t]=new o(this[t].ns,this[t].tag,this[t].name,this[t].props)),this[e][t].fresh()}async stale(t){const e=this._ns;this[e][t]&&this[e][t].rendered&&this[e][t].stale()}async reflow(t,e){const s=this._ns;e?this[s][t]=this.compo(this[s][t].params.ns,this[s][t].params.name,this[s][t].params.props):this[s][t]&&this[s][t].rendered&&this[s][t].fresh()}static isData(t){return r?r.for(t)===r.for(a.prototype):t&&"object"==typeof t&&"__Data"in t}get[r.toStringTag](){return"ensemble.Data"}}
/*!
   * loltgt ensemble.Event
   *
   * @version 0.0.1
   * @copyright Copyright (C) Leonardo Laureti
   * @license MIT License
   */const l="undefined"==typeof Symbol?0:Symbol;class h{constructor(t,e,s){if(!new.target)throw"ensemble error: Bad invocation, must be called with new.";const n=this._ns="_"+t;s=(o.isCompo(s)?s.node:s)||document,this.__Event=!0,this[n]={name:e,node:s}}add(t,e=!1){this[this._ns].node.addEventListener(this[this._ns].name,t,e)}remove(t){this[this._ns].node.removeEventListener(this[this._ns].name,t)}static isEvent(t){return l?l.for(t)===l.for(h.prototype):t&&"object"==typeof t&&"__Event"in t}get[l.toStringTag](){return"ensemble.Event"}}
/*!
   * loltgt ensemble.base
   *
   * @version 0.0.1
   * @copyright Copyright (C) Leonardo Laureti
   * @license MIT License
   */t.SocialShare=
/*!
   * loltgt ensemble.SocialShare
   *
   * @version 0.0.1
   * @copyright Copyright (C) Leonardo Laureti
   * @license MIT License
   */
class extends class{constructor(){if(!new.target)throw"ensemble error: Bad invocation, must be called with new."}defaults(t,e){const s={};for(const n in t)null!=t[n]&&"object"==typeof t[n]?s[n]=Object.assign(t[n],e[n]):s[n]=void 0!==e[n]?e[n]:t[n];return s}compo(t,e,s){return t?new o(this.options.ns,t,e,s):o}data(t){return t?new a(this.options.ns,t):a}event(t,e){return"string"==typeof t?new h(this.options.ns,t,e):t?(t.preventDefault(),void t.target.blur()):h}selector(t,e,s=!1){return e=e||document,s?e.querySelectorAll(t):e.querySelector(t)}appendNode(t,e){return!!t.appendChild(e)}prependNode(t,e){return!!t.prependChild(e)}removeNode(t,e){return!!t.removeChild(e)}cloneNode(t,e=!1){return t.cloneNode(e)}hasAttr(t,e){return t.hasAttribute(e)}getAttr(t,e){return t.getAttribute(e)}setAttr(t,e,s){t.setAttribute(e,s)}delAttr(t,e){t.removeAttribute(e)}binds(t){const e=this;return function(s){t.call(e,s,this)}}delay(t,e,s){const n=e?this.timing(e):0;setTimeout(t,n||s)}timing(t,e="transitionDuration"){let s=o.isCompo(t)?t.getStyle(e):window.getComputedStyle(t)[e];return s&&(s=s.indexOf("s")?1e3*parseFloat(s):parseInt(s)),s||0}}{_defaults(){return{ns:"share",fx:!0,root:"body",intents:{facebook:0,twitter:0,whatsapp:1,messenger:1,telegram:1,linkedin:0,"send-email":2,"copy-link":3,"web-share":4},uriform:{facebook:"https://facebook.com/sharer.php?u=%url%",twitter:"https://twitter.com/share?url=%url%&text=%title%",whatsapp:"https://api.whatsapp.com/send?text=%text%",messenger:"fb-messenger://share/?link=%url%&app_id=%app_id%",telegram:"https://telegram.me/share/url?url=%url%&text=%text%",linkedin:"https://www.linkedin.com/sharing/share-offsite?mini=true&url=%url%&title=%title%&ro=false&summary=%summary%","send-email":"mailto:?subject=%subject%&body=%text%"},label:{},locale:{label:"Share",share:"Share on %s",send:"Send to %s",subject:"An interesting thing",text:"Hi! There is something may interesting you: %s",email:"Send via email",copy:"Copy link",copied:"Copied link!",whatsapp:"WhatsApp",linkedin:"LinkedIn","web-share":"Share"},onInit:function(){},onIntent:function(){}}}_bindings(){this.intent=this.binds(this.intent)}constructor(t,e={}){super(),this._bindings(),this.options=this.defaults(this._defaults(),e),Object.freeze(this.options),this.element=t,this.init()}generator(){const t=this.options,e=this.share=this.compo("div","social-share");if(e.setAttr("data-social-share",""),e.up(this.element,function(t){this.element=t}.bind(this)),t.label){const s=this.compo("span","label",t.label);s.classList.add("label"),e.append(s)}const s=this.actions=this.compo("ul","actions");e.append(s),this.built=!0}init(){const t=this.options;this.built||(this.root=this.selector(t.root),this.generator(),this.populate(),t.onInit.call(this,this))}populate(){const t=this.options;for(const e in t.intents){const s=e in t.locale?t.locale[e]:e.replace(/\w/,(t=>t.toUpperCase()));let n;switch(t.intents[e]){case 0:n=t.locale.share.replace("%s",s);break;case 1:n=t.locale.send.replace("%s",s);break;case 2:n=t.locale.email;break;case 3:n=t.locale.copy;break;case 4:if(!("share"in window.navigator)||"function"!=typeof window.navigator.share)continue;n=t.locale["web-share"]}this.action(e,n)}}action(t,e){const s=this.options,n=this.compo("li","action",{className:s.ns+"-action-"+t}),i=this.compo("button","intent",{className:s.ns+"-intent-"+t,title:e,ariaLabel:e,onclick:this.intent});n.setAttr("data-share-intent",t),n.append(i);const o=this.compo("span","icon",{className:"icon-"+t});i.append(o),this.actions.append(n)}intent(t,e){if(this.event(t),!t.isTrusted)return;const s=this.options;if(!this.compo().isCompo(e))return;const n=e.parent;if(!n||!n.hasAttr("data-share-intent"))return;const i=n.getAttr("data-share-intent");let o,r,a,l;o=this.selector('link[rel="canonical"]')?this.selector('link[rel="canonical"]').href:window.location.href,r=a=document.title,this.selector('meta[name="description"]')&&(a=this.selector('meta[name="description"]').content),l="\r\n\r\n%title%\r\n%url%\r\n\r\n";const h={url:o,title:r,text:"\r\n\r\n%title%\r\n%url%\r\n\r\n",summary:a};if(s.onIntent.call(this,this,t,i,h),h.text=s.locale.text.replace("%s",h.text),i in s.intents)switch(i){case"send-email":this.sendEmail(t,h);break;case"copy-link":this.copyLink(t,h);break;case"web-share":this.webShare(t,h);break;default:this.social(t,h,i,n)}}text(t){return encodeURIComponent(t.text.replace("%url%",t.url).replace("%title%",t.title).replace("%summary%",t.summary))}social(t,e,s,n){const i=this.options;if(s in i.uriform==!1)return;let o=i.uriform[s].replace("%url%",encodeURIComponent(e.url)).replace("%title%",encodeURIComponent(e.title)).replace("%summary%",encodeURIComponent(e.summary));const r=n.getAttr("ariaLabel"),a="toolbar=0,status=0,width=640,height=480";if(/%text%/.test(i.uriform[s])&&(o=o.replace("%text%",this.text(e))),"messenger"===s){const t="messenger_app_id"in i?i.messenger_app_id:"";o=o.replace("%app_id%",encodeURIComponent(t))}console.log(o,r,a),window.open(o,r,a)}sendEmail(t,e){const s=this.options,n=s.uriform["send-email"].replace("%subject%",encodeURIComponent(s.locale.subject)).replace("%text%",this.text(e));console.log(n,"_self"),window.open(n,"_self")}copyLink(t,e){const s=this.options,n=document.createElement("textarea");if(n.style="position:absolute;width:0;height:0;opacity:0;z-index:-1;overflow:hidden",n.value=e.url.toString(),this.appendNode(this.element,n),/iPad|iPhone|iPod/.test(window.navigator.userAgent)){const t=document.createRange(),e=getSelection();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t),n.setSelectionRange(0,999999)}else n.focus(),n.select();if(document.execCommand("copy"),n.remove(),s.fx){const t=this.root,e=this.compo("div","fx-copied-link--ground",{hidden:!0}),n=this.compo("span","copied-link-message",{innerText:s.locale.copied});t.classList.add("share-fx-copied-link"),e.install(t),n.install(t),e.show(),this.delay((function(){n.uninstall(t),e.uninstall(t),t.classList.remove("share-fx-copied-link")}),e,800)}}async webShare(t,e){try{await window.navigator.share({title:e.title,url:e.url})}catch(t){t instanceof TypeError?console.info("ensemble.SocialShare.webShare","TODO fallback"):console.log("ensemble.SocialShare.webShare",t.message)}}}}));